<form
  [formGroup]="productForm"
  (ngSubmit)="onSubmit()"
  class="space-y-6 max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-md"
>
  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700"
      >Product Title *</label
    >
    <input
      formControlName="product_title"
      class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      [class.border-red-300]="
        productForm.get('product_title')?.invalid &&
        productForm.get('product_title')?.touched
      "
    />
    <div
      *ngIf="
        productForm.get('product_title')?.invalid &&
        productForm.get('product_title')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('product_title')?.errors?.['required']"
        >Title is required</span
      >
      <span *ngIf="productForm.get('product_title')?.errors?.['minlength']"
        >Must be at least 3 characters</span
      >
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700"
      >Product Image *</label
    >
    <input
      type="file"
      (change)="onFileSelected($event)"
      class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      [class.border-red-300]="
        productForm.get('product_image')?.invalid &&
        productForm.get('product_image')?.touched
      "
    />

    <div
      *ngIf="productForm.get('product_image')?.value && !selectedFile"
      class="mb-4"
    >
      <label class="block text-sm font-medium text-gray-700 mb-1"
        >Current Image:</label
      >
      <img
        [src]="
          'https://ggoli-store.vercel.app/uploads/' +productForm.get('product_image')?.value
        "
        alt="Current product image"
        class="w-32 h-32 object-cover rounded"
      />
    </div>

    <div
      *ngIf="
        productForm.get('product_image')?.invalid &&
        productForm.get('product_image')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('product_image')?.errors?.['required']"
        >Image is required</span
      >
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">Price *</label>
      <div class="relative rounded-md shadow-sm">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <span class="text-gray-500 sm:text-sm">$</span>
        </div>
        <input
          type="number"
          formControlName="price"
          class="block w-full pl-7 pr-12 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          [class.border-red-300]="
            productForm.get('price')?.invalid &&
            productForm.get('price')?.touched
          "
          min="0.01"
          step="0.01"
        />
      </div>
      <div
        *ngIf="
          productForm.get('price')?.invalid && productForm.get('price')?.touched
        "
        class="text-red-500 text-xs"
      >
        <span *ngIf="productForm.get('price')?.errors?.['required']"
          >Price is required</span
        >
        <span *ngIf="productForm.get('price')?.errors?.['min']"
          >Must be at least $0.01</span
        >
      </div>
    </div>

    <div class="space-y-2">
      <label class="block text-sm font-medium text-gray-700">Stock *</label>
      <input
        type="number"
        formControlName="stock"
        class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-300]="
          productForm.get('stock')?.invalid && productForm.get('stock')?.touched
        "
        min="0"
      />
      <div
        *ngIf="
          productForm.get('stock')?.invalid && productForm.get('stock')?.touched
        "
        class="text-red-500 text-xs"
      >
        <span *ngIf="productForm.get('stock')?.errors?.['required']"
          >Stock is required</span
        >
        <span *ngIf="productForm.get('stock')?.errors?.['min']"
          >Must be at least 0</span
        >
      </div>
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700">Min Stock</label>
    <input
      type="number"
      formControlName="minStock"
      class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      [class.border-red-300]="
        productForm.get('minStock')?.invalid &&
        productForm.get('minStock')?.touched
      "
      min="0"
    />
    <div
      *ngIf="
        productForm.get('minStock')?.invalid &&
        productForm.get('minStock')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('minStock')?.errors?.['min']"
        >Must be 0 or higher</span
      >
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700">Description *</label>
    <textarea
      formControlName="product_description"
      rows="4"
      class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      [class.border-red-300]="
        productForm.get('product_description')?.invalid &&
        productForm.get('product_description')?.touched
      "
    ></textarea>
    <div
      *ngIf="
        productForm.get('product_description')?.invalid &&
        productForm.get('product_description')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('product_description')?.errors?.['required']"
        >Description is required</span
      >
      <span
        *ngIf="productForm.get('product_description')?.errors?.['minlength']"
        >Must be at least 10 characters</span
      >
    </div>
  </div>

  <div class="space-y-2">
    <label class="block text-sm font-medium text-gray-700"
      >Category Name *</label
    >
    <input
      formControlName="category_name"
      class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      [class.border-red-300]="
        productForm.get('category_name')?.invalid &&
        productForm.get('category_name')?.touched
      "
      placeholder="Men Or Women"
    />
    <div
      *ngIf="
        productForm.get('category_name')?.invalid &&
        productForm.get('category_name')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('category_name')?.errors?.['required']"
        >Category name is required</span
      >
    </div>
  </div>

  <div class="space-y-2">
    <div class="flex justify-between items-center">
      <label class="block text-sm font-medium text-gray-700">Brand *</label>
      <button
        type="button"
        (click)="showBrandInput = !showBrandInput"
        class="text-xs text-blue-600 hover:text-blue-800"
      >
        {{ showBrandInput ? "Cancel" : "+ Add New Brand" }}
      </button>
    </div>

    <div *ngIf="!showBrandInput">
      <select
        formControlName="brand"
        class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-300]="
          productForm.get('brand')?.invalid && productForm.get('brand')?.touched
        "
      >
        <option value="">Select a brand</option>
        <option *ngFor="let item of brands" [value]="item._id">
          {{ item.brand_name }}
        </option>
      </select>
    </div>

    <div *ngIf="showBrandInput" class="flex space-x-2">
      <input
        #newBrandInput
        type="text"
        placeholder="Enter new brand name"
        class="flex-1 px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
      <button
        type="button"
        (click)="addNewBrand(newBrandInput.value); newBrandInput.value = ''"
        class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
      >
        Add
      </button>
    </div>

    <div
      *ngIf="
        productForm.get('brand')?.invalid && productForm.get('brand')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('brand')?.errors?.['required']"
        >Brand is required</span
      >
    </div>
  </div>

  <div class="space-y-2">
    <div class="flex justify-between items-center">
      <label class="block text-sm font-medium text-gray-700"
        >Subcategory *</label
      >
      <button
        type="button"
        (click)="showSubcategoryInput = !showSubcategoryInput"
        class="text-xs text-blue-600 hover:text-blue-800"
      >
        {{ showSubcategoryInput ? "Cancel" : "+ Add New Subcategory" }}
      </button>
    </div>

    <div *ngIf="!showSubcategoryInput">
      <select
        formControlName="subcategory"
        class="w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-300]="
          productForm.get('subcategory')?.invalid &&
          productForm.get('subcategory')?.touched
        "
      >
        <option value="">Select a subcategory</option>
        <option *ngFor="let item of subcategories" [value]="item._id">
          {{ item.subcategory_name }}
        </option>
      </select>
    </div>

    <div *ngIf="showSubcategoryInput" class="flex space-x-2">
      <input
        #newSubcategoryInput
        type="text"
        placeholder="Enter new subcategory name"
        class="flex-1 px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
      <button
        type="button"
        (click)="
          addNewSubcategory(newSubcategoryInput.value);
          newSubcategoryInput.value = ''
        "
        class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
      >
        Add
      </button>
    </div>

    <div
      *ngIf="
        productForm.get('subcategory')?.invalid &&
        productForm.get('subcategory')?.touched
      "
      class="text-red-500 text-xs"
    >
      <span *ngIf="productForm.get('subcategory')?.errors?.['required']"
        >Subcategory is required</span
      >
    </div>
  </div>

  <div class="flex items-center space-x-2">
    <input
      type="checkbox"
      id="isActive"
      formControlName="isActive"
      class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
    />
    <label for="isActive" class="block text-sm font-medium text-gray-700"
      >Is Active</label
    >
  </div>

  <div class="pt-4">
    <button
      type="submit"
      [disabled]="productForm.invalid"
      class="w-full px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-300 disabled:cursor-not-allowed"
    >
      Save Product
    </button>
  </div>
</form>
